<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1 class="test"></h1>
    <script>
        const test = document.querySelector('.test');
        let weatherObject = {
            location: '',
            current: {},
            dayList: [],
            hourlyReport: [],
        }
        const url = 'https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/'
        const key = '?key=GS4WHYRHXPH63Z32XEB64WU9W';

        function weatherReport(location) {
            let date1 = new Date
            fetch(url + location + '/' + key, {mode: "cors"})
            .then(response => response.json())
            .then(response => {
                test.textContent = response.days[0].description;
                populateWeatherObject(response);
                console.log(response);
            });
        }

        function populateWeatherObject(forecast) {
            weatherObject.location = forecast.resolvedAddress;
            let { currentConditions, days } = forecast;
            let hourly = days[0].hours;
            const desiredConditions = ['datetime','cloudcover','conditions','icon','temp', 'uvindex', 'precipprob'];
            const desiredField = ['conditions','description','tempmax','tempmin', 'precipprob'];
            getCurrentReport(currentConditions, desiredConditions);
            getDailyReport(days, desiredField);
            getHourlyReport(hourly, desiredConditions);
            console.log(weatherObject);
        }

        function getCurrentReport(currentConditions, desiredConditions) {
            for (let key in currentConditions) {
                if (desiredConditions.includes(key)) {
                    weatherObject.current[key] = currentConditions[key];
                }
            }
        }

        function getDailyReport(days, desiredField) {
            for (let i = 0; i < 11; i++) {
                weatherObject.dayList.push({});
                for (let field in days[i]) {
                    if (desiredField.includes(field)) {
                        weatherObject.dayList[i][field] = days[i][field];
                    }
                }
            }
        }

        function getHourlyReport(hourly, desiredConditions) {
            for (let i = 0; i < hourly.length; i++) {
                weatherObject.hourlyReport.push({});
                for (let field in hourly[i]) {
                    if (desiredConditions.includes(field)) {
                        weatherObject.hourlyReport[i][field] = hourly[i][field];
                    }
                }
            }
        }

        weatherReport('louisville');
    </script>
</body>
</html>